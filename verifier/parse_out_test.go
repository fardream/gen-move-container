package verifier_test

import (
	_ "embed"
	"testing"

	"github.com/fardream/gen-move-container/verifier"
	"github.com/google/go-cmp/cmp"
)

//go:embed parse_out_test_data.txt
var parseOutTestData string

func TestParseMoveTestOut(t *testing.T) {
	many, err := verifier.ParseMoveTestOut(parseOutTestData)
	if err != nil {
		t.Fatalf("failed to parse the text: %v\n%s", err, parseOutTestData)
	}

	expectedMany := [][]verifier.Entry{
		{{18, 18, 1, 18, 19, 128}, {16, 16, 3, 2, 0, 128}, {14, 14, 1, 16, 17, 128}, {12, 12, 7, 5, 1, 128}, {10, 10, 5, 14, 15, 128}, {8, 8, 3, 6, 4, 128}, {6, 6, 5, 12, 13, 128}, {4, 4, 18446744073709551615, 10, 3, 129}, {2, 2, 10, 18446744073709551615, 11, 129}, {0, 0, 10, 18446744073709551615, 18446744073709551615, 128}, {1, 1, 7, 9, 8, 129}, {3, 3, 8, 18446744073709551615, 18446744073709551615, 128}, {5, 5, 6, 18446744073709551615, 18446744073709551615, 128}, {7, 7, 6, 18446744073709551615, 18446744073709551615, 128}, {9, 9, 4, 18446744073709551615, 18446744073709551615, 128}, {11, 11, 4, 18446744073709551615, 18446744073709551615, 128}, {13, 13, 2, 18446744073709551615, 18446744073709551615, 128}, {15, 15, 2, 18446744073709551615, 18446744073709551615, 128}, {17, 17, 0, 18446744073709551615, 18446744073709551615, 128}, {19, 19, 0, 18446744073709551615, 18446744073709551615, 128}},
		{{18, 18, 1, 18, 9, 128}, {16, 16, 3, 2, 0, 128}, {14, 14, 1, 16, 17, 128}, {12, 12, 18446744073709551615, 7, 1, 127}, {10, 10, 5, 14, 15, 128}, {8, 8, 7, 6, 4, 128}, {6, 6, 5, 12, 13, 128}, {4, 4, 3, 8, 5, 129}, {2, 2, 7, 10, 11, 128}, {19, 19, 0, 18446744073709551615, 18446744073709551615, 128}, {1, 1, 8, 18446744073709551615, 18446744073709551615, 128}, {3, 3, 8, 18446744073709551615, 18446744073709551615, 128}, {5, 5, 6, 18446744073709551615, 18446744073709551615, 128}, {7, 7, 6, 18446744073709551615, 18446744073709551615, 128}, {9, 9, 4, 18446744073709551615, 18446744073709551615, 128}, {11, 11, 4, 18446744073709551615, 18446744073709551615, 128}, {13, 13, 2, 18446744073709551615, 18446744073709551615, 128}, {15, 15, 2, 18446744073709551615, 18446744073709551615, 128}, {17, 17, 0, 18446744073709551615, 18446744073709551615, 128}},
		{{18, 18, 1, 7, 9, 128}, {16, 16, 3, 2, 0, 128}, {14, 14, 1, 16, 17, 128}, {12, 12, 18446744073709551615, 12, 1, 127}, {10, 10, 5, 14, 15, 128}, {8, 8, 12, 6, 4, 128}, {6, 6, 5, 18446744073709551615, 13, 129}, {17, 17, 0, 18446744073709551615, 18446744073709551615, 128}, {2, 2, 12, 10, 11, 128}, {19, 19, 0, 18446744073709551615, 18446744073709551615, 128}, {1, 1, 8, 18446744073709551615, 18446744073709551615, 128}, {3, 3, 8, 18446744073709551615, 18446744073709551615, 128}, {5, 5, 3, 8, 5, 129}, {7, 7, 6, 18446744073709551615, 18446744073709551615, 128}, {9, 9, 4, 18446744073709551615, 18446744073709551615, 128}, {11, 11, 4, 18446744073709551615, 18446744073709551615, 128}, {13, 13, 2, 18446744073709551615, 18446744073709551615, 128}, {15, 15, 2, 18446744073709551615, 18446744073709551615, 128}},
		{{18, 18, 1, 7, 9, 128}, {16, 16, 3, 2, 0, 128}, {14, 14, 1, 16, 12, 128}, {12, 12, 18446744073709551615, 6, 1, 127}, {10, 10, 5, 14, 15, 128}, {8, 8, 6, 13, 4, 129}, {6, 6, 3, 8, 5, 129}, {17, 17, 0, 18446744073709551615, 18446744073709551615, 128}, {2, 2, 6, 10, 11, 128}, {19, 19, 0, 18446744073709551615, 18446744073709551615, 128}, {1, 1, 8, 18446744073709551615, 18446744073709551615, 128}, {3, 3, 8, 18446744073709551615, 18446744073709551615, 128}, {15, 15, 2, 18446744073709551615, 18446744073709551615, 128}, {7, 7, 5, 18446744073709551615, 18446744073709551615, 128}, {9, 9, 4, 18446744073709551615, 18446744073709551615, 128}, {11, 11, 4, 18446744073709551615, 18446744073709551615, 128}, {13, 13, 2, 18446744073709551615, 18446744073709551615, 128}},
		{{18, 18, 1, 7, 9, 128}, {16, 16, 3, 2, 0, 128}, {14, 14, 1, 13, 12, 128}, {12, 12, 18446744073709551615, 6, 1, 127}, {10, 10, 6, 5, 15, 127}, {8, 8, 4, 18446744073709551615, 14, 129}, {6, 6, 3, 8, 4, 129}, {17, 17, 0, 18446744073709551615, 18446744073709551615, 128}, {2, 2, 6, 10, 11, 128}, {19, 19, 0, 18446744073709551615, 18446744073709551615, 128}, {1, 1, 8, 18446744073709551615, 18446744073709551615, 128}, {3, 3, 8, 18446744073709551615, 18446744073709551615, 128}, {15, 15, 2, 18446744073709551615, 18446744073709551615, 128}, {13, 13, 2, 18446744073709551615, 18446744073709551615, 128}, {9, 9, 5, 18446744073709551615, 18446744073709551615, 128}, {11, 11, 4, 18446744073709551615, 18446744073709551615, 128}},
		{{18, 18, 1, 7, 9, 128}, {16, 16, 3, 2, 0, 128}, {14, 14, 1, 13, 12, 128}, {12, 12, 18446744073709551615, 6, 1, 127}, {10, 10, 6, 5, 10, 127}, {8, 8, 4, 18446744073709551615, 14, 129}, {6, 6, 3, 8, 4, 129}, {17, 17, 0, 18446744073709551615, 18446744073709551615, 128}, {2, 2, 6, 18446744073709551615, 11, 129}, {19, 19, 0, 18446744073709551615, 18446744073709551615, 128}, {11, 11, 4, 18446744073709551615, 18446744073709551615, 128}, {3, 3, 8, 18446744073709551615, 18446744073709551615, 128}, {15, 15, 2, 18446744073709551615, 18446744073709551615, 128}, {13, 13, 2, 18446744073709551615, 18446744073709551615, 128}, {9, 9, 5, 18446744073709551615, 18446744073709551615, 128}},
		{{18, 18, 1, 7, 9, 128}, {16, 16, 3, 2, 0, 128}, {14, 14, 1, 13, 12, 128}, {12, 12, 18446744073709551615, 5, 1, 128}, {10, 10, 5, 8, 10, 128}, {8, 8, 3, 6, 4, 128}, {6, 6, 5, 11, 18446744073709551615, 127}, {17, 17, 0, 18446744073709551615, 18446744073709551615, 128}, {9, 9, 4, 18446744073709551615, 18446744073709551615, 128}, {19, 19, 0, 18446744073709551615, 18446744073709551615, 128}, {11, 11, 4, 18446744073709551615, 18446744073709551615, 128}, {3, 3, 6, 18446744073709551615, 18446744073709551615, 128}, {15, 15, 2, 18446744073709551615, 18446744073709551615, 128}, {13, 13, 2, 18446744073709551615, 18446744073709551615, 128}},
		{{18, 18, 1, 7, 9, 128}, {16, 16, 3, 2, 0, 128}, {14, 14, 1, 11, 12, 128}, {12, 12, 18446744073709551615, 5, 1, 128}, {10, 10, 5, 8, 10, 128}, {8, 8, 3, 6, 4, 129}, {6, 6, 5, 18446744073709551615, 18446744073709551615, 128}, {17, 17, 0, 18446744073709551615, 18446744073709551615, 128}, {9, 9, 4, 18446744073709551615, 18446744073709551615, 128}, {19, 19, 0, 18446744073709551615, 18446744073709551615, 128}, {11, 11, 4, 18446744073709551615, 18446744073709551615, 128}, {13, 13, 2, 18446744073709551615, 18446744073709551615, 128}, {15, 15, 2, 18446744073709551615, 18446744073709551615, 128}},
		{{18, 18, 1, 7, 9, 128}, {16, 16, 3, 2, 0, 128}, {14, 14, 1, 11, 6, 128}, {12, 12, 18446744073709551615, 4, 1, 128}, {10, 10, 3, 5, 10, 127}, {8, 8, 4, 18446744073709551615, 8, 129}, {15, 15, 2, 18446744073709551615, 18446744073709551615, 128}, {17, 17, 0, 18446744073709551615, 18446744073709551615, 128}, {9, 9, 5, 18446744073709551615, 18446744073709551615, 128}, {19, 19, 0, 18446744073709551615, 18446744073709551615, 128}, {11, 11, 4, 18446744073709551615, 18446744073709551615, 128}, {13, 13, 2, 18446744073709551615, 18446744073709551615, 128}},
		{{18, 18, 1, 7, 9, 128}, {16, 16, 3, 2, 0, 128}, {14, 14, 1, 5, 6, 128}, {12, 12, 18446744073709551615, 4, 1, 129}, {10, 10, 3, 8, 10, 128}, {13, 13, 2, 18446744073709551615, 18446744073709551615, 128}, {15, 15, 2, 18446744073709551615, 18446744073709551615, 128}, {17, 17, 0, 18446744073709551615, 18446744073709551615, 128}, {9, 9, 4, 18446744073709551615, 18446744073709551615, 128}, {19, 19, 0, 18446744073709551615, 18446744073709551615, 128}, {11, 11, 4, 18446744073709551615, 18446744073709551615, 128}},
		{{18, 18, 1, 7, 9, 128}, {16, 16, 3, 2, 0, 128}, {14, 14, 1, 5, 6, 128}, {12, 12, 18446744073709551615, 4, 1, 129}, {10, 10, 3, 18446744073709551615, 8, 129}, {13, 13, 2, 18446744073709551615, 18446744073709551615, 128}, {15, 15, 2, 18446744073709551615, 18446744073709551615, 128}, {17, 17, 0, 18446744073709551615, 18446744073709551615, 128}, {11, 11, 4, 18446744073709551615, 18446744073709551615, 128}, {19, 19, 0, 18446744073709551615, 18446744073709551615, 128}},
		{{18, 18, 1, 7, 4, 128}, {16, 16, 18446744073709551615, 3, 0, 127}, {14, 14, 3, 5, 6, 128}, {12, 12, 1, 8, 2, 129}, {19, 19, 0, 18446744073709551615, 18446744073709551615, 128}, {13, 13, 2, 18446744073709551615, 18446744073709551615, 128}, {15, 15, 2, 18446744073709551615, 18446744073709551615, 128}, {17, 17, 0, 18446744073709551615, 18446744073709551615, 128}, {11, 11, 3, 18446744073709551615, 18446744073709551615, 128}},
		{{18, 18, 1, 7, 4, 128}, {16, 16, 18446744073709551615, 2, 0, 127}, {14, 14, 1, 3, 6, 127}, {12, 12, 2, 18446744073709551615, 5, 129}, {19, 19, 0, 18446744073709551615, 18446744073709551615, 128}, {13, 13, 3, 18446744073709551615, 18446744073709551615, 128}, {15, 15, 2, 18446744073709551615, 18446744073709551615, 128}, {17, 17, 0, 18446744073709551615, 18446744073709551615, 128}},
		{{18, 18, 1, 3, 4, 128}, {16, 16, 18446744073709551615, 2, 0, 128}, {14, 14, 1, 5, 6, 128}, {17, 17, 0, 18446744073709551615, 18446744073709551615, 128}, {19, 19, 0, 18446744073709551615, 18446744073709551615, 128}, {13, 13, 2, 18446744073709551615, 18446744073709551615, 128}, {15, 15, 2, 18446744073709551615, 18446744073709551615, 128}},
		{{18, 18, 1, 3, 4, 128}, {16, 16, 18446744073709551615, 2, 0, 128}, {14, 14, 1, 18446744073709551615, 5, 129}, {17, 17, 0, 18446744073709551615, 18446744073709551615, 128}, {19, 19, 0, 18446744073709551615, 18446744073709551615, 128}, {15, 15, 2, 18446744073709551615, 18446744073709551615, 128}},
		{{18, 18, 1, 3, 4, 128}, {16, 16, 18446744073709551615, 2, 0, 129}, {15, 15, 1, 18446744073709551615, 18446744073709551615, 128}, {17, 17, 0, 18446744073709551615, 18446744073709551615, 128}, {19, 19, 0, 18446744073709551615, 18446744073709551615, 128}},
		{{18, 18, 18446744073709551615, 1, 2, 127}, {16, 16, 0, 18446744073709551615, 3, 129}, {19, 19, 0, 18446744073709551615, 18446744073709551615, 128}, {17, 17, 1, 18446744073709551615, 18446744073709551615, 128}},
		{{18, 18, 18446744073709551615, 1, 2, 128}, {17, 17, 0, 18446744073709551615, 18446744073709551615, 128}, {19, 19, 0, 18446744073709551615, 18446744073709551615, 128}},
		{{18, 18, 18446744073709551615, 18446744073709551615, 1, 129}, {19, 19, 0, 18446744073709551615, 18446744073709551615, 128}},
		{{19, 19, 18446744073709551615, 18446744073709551615, 18446744073709551615, 128}},
	}

	if !cmp.Equal(many, expectedMany) {
		t.Errorf("expecting: %#v, got: %#v", expectedMany, many)
	}

	e, err := verifier.ParseMoveTestOut("[debug] (&) [{ 19, 19, 18446744073709551615, 18446744073709551615, 18446744073709551615, 128 }]")
	if err != nil {
		t.Fatalf("failed to parse the text: %v\n%s", err, parseOutTestData)
	}

	expected := [][]verifier.Entry{{{Key: 19, Value: 19, Parent: verifier.NULL_INDEX, LeftChild: verifier.NULL_INDEX, RightChild: verifier.NULL_INDEX, Metadata: 128}}}

	if !cmp.Equal(expected, e) {
		t.Errorf("expecting: %#v, got: %#v", expected, e)
	}
}
